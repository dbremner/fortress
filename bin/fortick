#!/bin/bash

################################################################################
#    Copyright 2008 Sun Microsystems, Inc.,
#    4150 Network Circle, Santa Clara, California 95054, U.S.A.
#    All rights reserved.
#
#    U.S. Government Rights - Commercial software.
#    Government users are subject to the Sun Microsystems, Inc. standard
#    license agreement and applicable provisions of the FAR and its supplements.
#
#    Use is subject to license terms.
#
#    This distribution may include materials developed by third parties.
#
#    Sun, Sun Microsystems, the Sun logo and Java are trademarks or registered
#    trademarks of Sun Microsystems, Inc. in the U.S. and other countries.
################################################################################

FORTRESS_HOME="`${0%fortick}fortress_home`"

if [ $# -ne 1 ] ; then
  echo "fortick somefile.suffix"
  echo "Replaces backtick-delimited fortress with nicely formatted fortress."
  echo "Writes to somefile.tex (will overwrite original if suffix = tex)"
  exit 1
fi

if grep -q "usepackage{fortify}" $1 ; then
  true
else
  echo "WARNING: input file lacks \\usepackage{fortify}"
fi

BASENAME=${1%.*}

USE_EMACS=${USE_EMACS:-emacs}
[ -n "$EMACS" ] && unset EMACSLOADPATH
"${USE_EMACS}" -batch "$@" -l "$FORTRESS_HOME/Fortify/fortify.el" -f fortick

echo "Process with"
echo "  TEXINPUTS=.:${FORTRESS_HOME}/Fortify: latex ${BASENAME}.tex"
